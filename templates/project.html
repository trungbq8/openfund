<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0 maximum-scale=1, user-scalable=no">
	<title>OpenFund - Project Details</title>
	<link rel="icon" href="/static/app_assets/open_fund_logo.png">
	<link rel="stylesheet" href="/static/css/style.css">
	<link href="https://fonts.googleapis.com/css2?family=Poppins:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&family=Roboto:ital,wght@0,100..900;1,100..900&display=swap" rel="stylesheet">
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.2/css/all.min.css">
	<link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/toastify-js/src/toastify.min.css">
   <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/toastify-js"></script>
	<script src="https://cdn.jsdelivr.net/npm/ethers@6.13.0/dist/ethers.umd.min.js"></script></head>
<body>
	<div class="loading-spinner hidden" id="loading-spinner">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 200 200"><circle fill="#000000" stroke="#000000" stroke-width="15" r="15" cx="40" cy="100"><animate attributeName="opacity" calcMode="spline" dur="2" values="1;0;1;" keySplines=".5 0 .5 1;.5 0 .5 1" repeatCount="indefinite" begin="-.4"></animate></circle><circle fill="#000000" stroke="#000000" stroke-width="15" r="15" cx="100" cy="100"><animate attributeName="opacity" calcMode="spline" dur="2" values="1;0;1;" keySplines=".5 0 .5 1;.5 0 .5 1" repeatCount="indefinite" begin="-.2"></animate></circle><circle fill="#000000" stroke="#000000" stroke-width="15" r="15" cx="160" cy="100"><animate attributeName="opacity" calcMode="spline" dur="2" values="1;0;1;" keySplines=".5 0 .5 1;.5 0 .5 1" repeatCount="indefinite" begin="0"></animate></circle></svg>
   </div>
	<!-- nav bar -->
	<div class="nav-bar">
      <div class="app-logo" onclick="window.location.href='/'">
         <img src="/static/app_assets/open_fund_logo.png" alt="OpenFund logo">
         <p>OpenFund</p>
      </div>
      <div class="nav-bar-select">
         <div class="link" onclick="window.location.href='/invest'">Invest</div>
			<div class="link" onclick="window.location.href='/blog'">Blog</div>
			<div class="link" onclick="window.location.href='/document'">Document</div>
      </div>
      <div class="authenticate">
         <button class="sign-in-up" onclick="window.location.href='/sign-up'" id="sign-in-up-btn">Log In/Sign Up</button>
         <button class="connect-wallet" id="connect-btn">
            <i class="fa-solid fa-wallet"></i>
            <div class="investor_connected_check hidden" id="investor_connected_check" style="background-color: white; color: rgb(0, 1, 69); font-size: 15px; position: absolute; bottom: -3px; right: -3px; display: flex; align-items: center; justify-content: center; border-radius: 50%;"><i class="fa-solid fa-circle-check"></i></div>
         </button>
         <button class="raiser-account hidden" id="raiser-account">
            <i class="fa-solid fa-user"></i>
         </button>
      </div>
      <button class="menu-btn">
         <i class="fa-solid fa-bars"></i>
      </button>
      <div class="investor-account-manage hidden" id="investor-account-manage">
         <p>Investor account</p>
         <input name="investor-wallet-address" id="investor-wallet-address" style="text-align: center; font-size: 12px; padding: 0; border: 0;" readonly required>
         <div class="investor-account-manage-btn" onclick="window.location.href='/edit-profile'">Edit profile</div>
         <div class="investor-account-manage-btn" id="investor-disconnect-btn">Disconnect</div>
      </div>
      <div class="raiser-account-manage hidden" id="raiser-account-manage">
         <p>Raiser account</p>
         <div class="raiser-account-manage-btn" onclick="window.location.href='/submitted-project'">Submitted projects</div>
         <div class="raiser-account-manage-btn" onclick="window.location.href='/raiser-profile/{{ raiser_id }}'">Profile</div>
         <div class="raiser-account-manage-btn" onclick="window.location.href='/edit-account'">Account settings</div>
         <div class="raiser-account-manage-btn" id="raiser-log-out-btn" onclick="window.location.href='/log-out'">Log out</div>
      </div>
   </div>
   <div class="nav-bar-mobile hidden">
      <div class="link-mobile" onclick="window.location.href='/invest'">Invest<i class="fa-solid fa-arrow-right"></i></div>
      <hr>
      <div class="link-mobile" onclick="window.location.href='/blog'">Blog<i class="fa-solid fa-arrow-right"></i></div>
      <hr>
      <div class="link-mobile" onclick="window.location.href='/document'">Document<i class="fa-solid fa-arrow-right"></i></div>
      <hr>
      <div class="authenticate-mobile">
         <button class="connect-wallet-mobile" id="connect-btn-mobile">
            Connect wallet<i class="fa-solid fa-wallet"></i>
         </button>
         <button class="sign-in-up-mobile" onclick="window.location.href='/sign-up'" id="sign-in-up-mobile-btn">Log In/Sign Up</button>
         <button class="sign-in-up-mobile" id="raiser-account-mobile-btn">Raiser Account</button>
      </div>
      <div class="investor-account-manage-mobile hidden" id="investor-account-manage-mobile">
         <p>Investor account</p>
         <input name="investor-wallet-address hidden" id="investor-wallet-address-mobile" style="text-align: center; font-size: 12px; padding: 0; border: 0;" readonly required>
         <div class="investor-account-manage-btn" onclick="window.location.href='/edit-profile'">Edit profile</div>
         <div class="investor-account-manage-btn" id="investor-disconnect-btn-mobile">Disconnect</div>
      </div>
      <div class="raiser-account-manage-mobile hidden" id="raiser-account-manage-mobile">
         <p>Raiser account</p>
         <div class="raiser-account-manage-btn" onclick="window.location.href='/submitted-project'">Submitted projects</div>
         <div class="raiser-account-manage-btn" onclick="window.location.href='/raiser-profile/{{ raiser_id }}'">Profile</div>
         <div class="raiser-account-manage-btn" onclick="window.location.href='/edit-account'">Account settings</div>
         <div class="raiser-account-manage-btn" id="raiser-log-out-btn-mobile" onclick="window.location.href='/log-out'">Log out</div>
      </div>
      <button class="close-nav-bar-mobile-btn" id="close-nav-bar-mobile-btn">Close</button>
   </div>
	 <!-- end nav bar -->
	<!-- connect wallet -->
	<div class="overlay hidden" id="overlay">
		<div class="connect-wallet-box hidden" id="connect-wallet-box">
			<button class="close-connect-wallet-btn" id="close-connect-wallet-btn">
				<i class="fa-solid fa-xmark"></i>
			</button>
			<h1>Connect wallet</h1>
			<p>(For investors only)</p>
			<hr style="width: 100px;">
			<button class="wallet_intergrated" data-wallet="metamask"><img class="wallet-icon-logo" src="/static/app_assets/metamask.png" alt="Metamask logo">Metamask</button>
         <button class="wallet_intergrated" data-wallet="binance"><img class="wallet-icon-logo" src="/static/app_assets/binance_web3.png" alt="Metamask logo">Binance Web3</button>
         <button class="wallet_intergrated" data-wallet="okx"><img class="wallet-icon-logo" src="/static/app_assets/okx_web3.png" alt="Metamask logo">OKX Web3</button>
         <button class="wallet_intergrated" data-wallet="trust"><img class="wallet-icon-logo" src="/static/app_assets/trust_wallet.png" alt="Metamask logo">Trust Wallet</button>
         <button class="wallet_intergrated" data-wallet="coinbase"><img class="wallet-icon-logo" src="/static/app_assets/coinbase_wallet.png" alt="Metamask logo">Coinbase Wallet</button>
         <p>By connecting a wallet, you agree to the OpenFund’s <a style="color:black" href="/legal#terms-of-service">Terms of Service</a> and consent to its <a style="color:black" href="/legal#privacy-policy">Privacy Policy</a>.</p>
		</div>
	</div>
   <style>
      .project-wrapper{
			margin-top: 120px;
			width: 100%;
			display: flex;
			flex-direction: column;
			padding: 30px 20px;
			align-items: center;
			justify-content: center;
			box-sizing: border-box;
		}
		.project{
			width: clamp(330px, 90%, 600px);
			border: solid 1px #d8d8d8;
			background-color: white;
			border-radius: 30px;
			box-shadow: 0 10px 20px rgba(0, 0, 0, 0.05);
			overflow: hidden;
		}
		.project-header {
            padding: 20px;
            background: linear-gradient(135deg, #000145, #d14646);
            color: white;
		}
		
		.project-name {
			font-size: 24px;
			font-weight: 600;
		}
		
		.raiser-name {
			font-size: 14px;
			opacity: 0.9;
		}
		
		.end-time {
			font-size: 14px;
			opacity: 0.9;
		}
		
		.project-body {
			padding: 20px;
		}
		
		.info-row {
			display: flex;
			justify-content: space-between;
			margin-bottom: 15px;
		}
		
		.info-label {
			color: #6c757d;
			font-size: 14px;
		}
		
		.info-value {
			font-weight: 600;
			font-size: 15px;
		}
		
		.stage-badge {
			display: inline-block;
			background-color: #edf2ff;
			color: #4263eb;
			padding: 5px 10px;
			border-radius: 12px;
			font-size: 12px;
			font-weight: 600;
		}
		
		.progress-container {
			margin: 20px 0;
		}
		
		.progress-label {
			display: flex;
			justify-content: space-between;
			margin-bottom: 5px;
			font-size: 14px;
		}
		
		.progress-bar {
			height: 8px;
			background-color: #e9ecef;
			border-radius: 4px;
			overflow: hidden;
			margin-bottom: 5px;
		}
		
		.progress {
			height: 100%;
			background: linear-gradient(135deg, #000145, #d14646);
			border-radius: 4px;
			width: 75%;
		}
		
		.token-info {
			font-size: clamp(8px, 2vw, 12px);
			color: #6c757d;
			display: flex;
			justify-content: space-between;
		}
		
		.refund-container {
			margin: 20px 0;
			padding: 15px;
			background-color: #f8f9fa;
			border-radius: 8px;
		}
		
		.refund-header {
			display: flex;
			justify-content: space-between;
			margin-bottom: 15px;
		}
		
		.refund-title {
			font-weight: 600;
			font-size: 14px;
		}
		
		.refund-progress-bar {
			height: 8px;
			background-color: #e9ecef;
			border-radius: 4px;
			overflow: hidden;
			margin-bottom: 5px;
		}
		
		.refund-progress {
			height: 100%;
			background: linear-gradient(90deg, #fd7e14, #ff9800);
			border-radius: 4px;
			width: 30%;
		}
		
		.project-actions {
			margin-top: 20px;
			display: grid;
			grid-template-columns: 1fr 1fr;
			gap: 10px;
		}
		
		.invest-btn {
			background-color: #d8d8d8;
			color: #6c757d;
			grid-column: span 2;
			padding: 12px;
			border: none;
			border-radius: 8px;
			font-weight: 600;
			cursor: not-allowed;
		}
		
		.request-refund-btn, .claim-refund-btn {
			background-color: transparent;
			border: 1px solid #dee2e6;
			color: #6c757d;
			padding: 12px;
			border-radius: 8px;
			font-weight: 600;
			cursor: not-allowed;
		}
		
		.request-refund-btn:hover, .claim-refund-btn:hover {
			background-color: #f8f9fa;
		}
   </style>
   <div class="project-wrapper">
		<img style="width: 100px; height: 100px; border-radius: 50%; margin-bottom: 10px;" src="{{ project.logo_url if project.logo_url else '/static/app_assets/open_fund_logo.png' }}">
		<h1 style="margin:0" id="project-name">{{ project.name }}</h1>
		<div style="display: flex; align-items: center;"><p style="margin:0 5px 0 0"><i>by</i></p><h3 style="margin:0; cursor: pointer" id="raiser-name" onclick="window.location.href='/raiser-profile/{{ project.raiser_username }}'">{{ project.raiser_name }}</h3></div>
		<h3 style="margin-top: 50px;">INTRODUCTION</h3>
		<div style="width: 100%; max-width: 800px; text-align: justify;" class="introduction" id="introduction">{{ project.description | safe }}
			<p><b>⚠️ Disclaimer</b><i> All information provided on this profile page has been submitted by the raiser and is not independently verified by our platform. We do not guarantee the accuracy, completeness, or reliability of the content. Investors are encouraged to conduct their own due diligence before making any decisions.</i></p>
		</div>
		<style>
			.token-details-table {
			  width: 100%;
			  max-width: 800px;
			  margin: 20px auto 0px auto;
			}
			
			.token-details-table h3 {
			  text-align: center;
			  margin-bottom: 15px;
			}
			
			.token-details-table table {
			  width: 100%;
			  border-collapse: separate;
			  border-radius: 12px;
			  border: solid 1px rgb(233, 233, 233);
			  overflow: hidden;
			  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
			}
			
			.token-details-table th, 
			.token-details-table td {
			  padding: 12px 15px;
			  text-align: left;
			  border-bottom: 1px solid #eee;
			  word-break: break-word;
			}
			
			.token-details-table tr:nth-child(even) {
			  background-color: #f8f9fa;
			}
			
			.token-details-table tr:hover {
			  background-color: #f1f3f5;
			}
			
			.token-details-table tr:last-child td {
			  border-bottom: none;
			}
			
			@media (max-width: 600px) {
			  .token-details-table table {
				 font-size: 14px;
			  }
			  
			  .token-details-table th, 
			  .token-details-table td {
				 padding: 10px;
			  }
			}
			</style>
		<div class="token-details-table">
			<h3>TOKEN DETAILS</h3>
			<table>
			  <tbody>
				 <tr>
					<td>Token Name</td>
					<td>{{ project.token_name }}</td>
				 </tr>
				 <tr>
					<td>Token Symbol</td>
					<td>{{ project.token_symbol }}</td>
				 </tr>
				 <tr>
					<td>Token Contract Address</td>
					<td style="-webkit-user-select:text;">{{ project.token_address }}</td>
				 </tr>
				 <tr>
					<td>Decimals</td>
					<td>{{ project.decimal }}</td>
				 </tr>
				 <tr>
					<td>Total Supply</td>
					<td>{{ "{:,}".format(project.total_token_supply) }} {{ project.token_symbol }}</td>
				 </tr>
				 <tr>
					<td>Tokens for Sale</td>
					<td>{{ "{:,}".format(project.token_to_sell) }} {{ project.token_symbol }}</td>
				 </tr>
			  </tbody>
			</table>
		 </div>
		 <h3 style="margin-bottom: 0; margin-top: 50px;">COMMUNITY LINKS</h3>
		 <style>
			.project-link{
				width: 150px;
				height: 50px;
				border: solid 1px black;
				display: flex;
				align-items: center;
				justify-content: center;
				cursor: pointer;
			}
			.project-link:hover{
				background-color: #f8f9fa;
			}
		 </style>
		 <div class="community-links" style="margin-top: 20px; display: flex; align-items: center; justify-content: center; flex-wrap: wrap; gap: 10px;">
			<div class="project-link" onclick="window.location.href='{{ project.x_link }}'">
				<p><i class="fa-brands fa-square-x-twitter"></i> X</p></div>
			<div class="project-link" onclick="window.location.href='{{ project.telegram_link }}'">
				<p><i class="fa-brands fa-telegram"></i> Telegram</p></div>
			<div class="project-link" onclick="window.location.href='{{ project.website_link }}'">
				<p><i class="fa-solid fa-link"></i> Website</p></div>
			<div class="project-link" onclick="window.location.href='{{ project.whitepaper_link }}'">
				<p><i class="fa-solid fa-book"></i> Whitepaper</p></div>
		 </div>
		<h3 style="margin-top: 50px;">INVEST</h3>
		<div class="project">
			<div class="project-header">
            <div class="project-name" id="project-name">{{ project.name }}</div>
            <div class="raiser-name" id="raiser-name">{{ project.raiser_name }}</div>
            <div class="end-time"><span id="end-time-text">Funding ends in: </span><span id="investment-end-time"></span></div>
        </div>
        <script>
			let unixTimestamp = Number({{ project.end_time }});
			function updateCountdown() {
				 const endDate = new Date(unixTimestamp * 1000);
				 const now = new Date();
				 
				 const countdownElement = document.getElementById("investment-end-time");
				 
				 if (now >= endDate) {
					  const options = {
							year: 'numeric',
							month: 'long',
							day: 'numeric',
							hour: '2-digit',
							minute: '2-digit',
							hour12: false
					  };
					  const formattedEndDate = endDate.toLocaleString(undefined, options);
					  countdownElement.innerHTML = `Ended at <span class="ended-badge">${formattedEndDate}</span>`;
					  document.getElementById("end-time-text").innerHTML = "";
				 } else {
					  const timeDiff = endDate - now;
					  
					  const days = Math.floor(timeDiff / (1000 * 60 * 60 * 24));
					  const hours = Math.floor((timeDiff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
					  const minutes = Math.floor((timeDiff % (1000 * 60 * 60)) / (1000 * 60));
					  const seconds = Math.floor((timeDiff % (1000 * 60)) / 1000);
					  
					  countdownElement.innerHTML = `<span class="countdown-timer" style="color:red">${days}d ${hours}h ${minutes}m ${seconds}s</span>`;
				 }
			}
			
			updateCountdown();
			
			setInterval(updateCountdown, 1000);

			function updateProgressBars() {
				const tokenSold = {{ project.token_sold }};
				const tokenToSell = {{ project.token_to_sell }};
				const salePercentage = (tokenSold / tokenToSell) * 100;
				
				const saleProgressDisplay = document.getElementById("token-sale-progress");
				saleProgressDisplay.textContent = salePercentage.toFixed(2) + "%";
				
				const progressBar = document.querySelector(".progress");
				progressBar.style.width = salePercentage + "%";
				
				const voteForRefund = {{ project.vote_for_refund }};
				const refundPercentage = (voteForRefund / tokenSold) * 100 || 0;
				
				const refundProgressDisplay = document.getElementById("request-for-refund-progress");
				refundProgressDisplay.textContent = refundPercentage.toFixed(2) + "%";
				
				const refundProgressBar = document.querySelector(".refund-progress");
				refundProgressBar.style.width = refundPercentage + "%";
			}

			document.addEventListener("DOMContentLoaded", function() {
				updateProgressBars();
			});
			</script>
        <div class="project-body">
            <div class="info-row">
                <span class="info-label">Token Price</span>
                <span class="info-value" id="token-price">{{ project.token_price }} USDT</span>
            </div>
            
            <div class="info-row">
                <span class="info-label">Funds Raised</span>
                <span class="info-value" id="fund-raised">{{ project.fund_raised }} USDT</span>
            </div>
            
            <div class="info-row">
                <span class="info-label">Stage</span>
                <span class="stage-badge" id="funding-status">{{ project.funding_status.capitalize() }}</span>
            </div>
            
            <div class="progress-container">
                <div class="progress-label">
                    <span>Token Sale Progress</span>
                    <span id="token-sale-progress">80%</span>
                </div>
                <div class="progress-bar">
                    <div class="progress"></div>
                </div>
                <div class="token-info">
                    <span id="token-sold">{{ "{:,}".format(project.token_sold) }} {{ project.token_symbol }}</span>
                    <span id="token-to-sell">{{ "{:,}".format(project.token_to_sell) }} {{ project.token_symbol }}</span>
                </div>
            </div>
            
            <div class="refund-container">
                <div class="refund-header">
                    <span class="refund-title">Request for Refund</span>
                    <span class="refund-title" id="request-for-refund-progress">30%</span>
                </div>
                <div class="refund-progress-bar">
                    <div class="refund-progress"></div>
                </div>
                <div class="token-info">
                    <span id="request-for-refund-token">{{ "{:,}".format(project.vote_for_refund) }} {{ project.token_symbol }}</span>
                    <span id="token-sold">{{ "{:,}".format(project.token_sold) }} {{ project.token_symbol }}</span>
                </div>
            </div>
            <div style="display: flex; flex-direction:column; align-items: start; width: 100%;">
					<span style="font-size: 14px; margin-bottom: 5px;">Enter USDT amount<span id="remaining-buy-amount-text"> (<span id="remaining-buy-amount">--</span> USDT remaining)</span></span>
					<input id="usdt-amount" style="width: 100%; box-sizing: border-box;" placeholder="Must be muliples of 100 USDT." readonly></input>
				</div>
				<p style="margin: 5px 0 0 0; font-size: 14px; text-align: right;">Balance: <span id="usdt-balance">--</span> USDT</p>
				<p style="margin: 0; font-size: 14px; text-align: right;">You will receive <span id="token-to-receive">--</span> {{ project.token_symbol }}</p>
            <p id="connect-wallet-alert" style="margin: 0; font-size: 14px; text-align: center; color: red; margin-top: 10px;">Connect wallet to continue.</p>
				<div class="project-actions">
                <button class="invest-btn" disabled>Invest Now</button>
                <button class="request-refund-btn" disabled>Request Refund</button>
                <button class="claim-refund-btn" disabled>Claim Refund</button>
            </div>
        </div>
		</div>
		<div class="like-section" style="margin-top: 20px; width: 100%; max-width: 600px; display: flex; justify-content: center;">
			<button id="like-button" class="like-btn">
			  <i class="fa-regular fa-heart" id="like-icon"></i>
			  <span id="like-count">0</span>
			</button>
		 </div>
		 <div class="faucet-section" style="margin: 0; width: 100%; display: flex; flex-direction: column; align-items: center; justify-content: center;">
			<p style="text-align: center; margin-bottom: 10px; color: #6c757d;">Need test tokens to invest in this project?</p>
			<a href="/faucet" class="faucet-link">
				<div class="faucet-button">
					<i class="fa-solid fa-faucet"></i>
					<span>Get Free Test Tokens</span>
				</div>
			</a>
		</div>
		
		 <style>
			.like-btn {
			  display: flex;
			  align-items: center;
			  justify-content: center;
			  gap: 8px;
			  background-color: white;
			  border: 1px solid #dee2e6;
			  color: #6c757d;
			  padding: 10px 20px;
			  border-radius: 20px;
			  font-weight: 600;
			  cursor: pointer;
			  transition: all 0.2s ease;
			}
			
			.like-btn:hover {
			  background-color: #f8f9fa;
			}
			
			.like-btn.liked {
			  border-color: #d14646;
			  color: #d14646;
			}
			
			.like-btn.liked i {
			  color: #d14646;
			}
			
			.like-btn i {
			  font-size: 18px;
			  transition: transform 0.3s ease;
			}
			
			.like-btn:hover i {
			  transform: scale(1.2);
			}
			
			.like-btn.liked i.fa-regular.fa-heart {
			  display: none;
			}
			
			.like-btn:not(.liked) i.fa-solid.fa-heart {
			  display: none;
			}
			
			@keyframes like-animation {
			  0% { transform: scale(1); }
			  50% { transform: scale(1.3); }
			  100% { transform: scale(1); }
			}
			
			.like-animation {
			  animation: like-animation 0.5s ease;
			}
			.faucet-link {
				text-decoration: none;
			}

			.faucet-button {
				display: flex;
				align-items: center;
				justify-content: center;
				gap: 10px;
				background: linear-gradient(135deg, #000145, #d14646);
				color: white;
				padding: 12px 24px;
				border-radius: 25px;
				font-weight: 600;
				cursor: pointer;
				transition: all 0.3s ease;
				box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
				border: none;
			}

			.faucet-button:hover {
				transform: translateY(-2px);
				box-shadow: 0 6px 16px rgba(0, 0, 0, 0.2);
				opacity: 0.95;
			}

			.faucet-button i {
				font-size: 20px;
			}

	</style>
	</div>
   <div class="footer">
		<div class="app-info">
			<div class="app-logo-footer" onclick="window.location.href='/'">
				<img src="/static/app_assets/open_fund_logo.png" alt="OpenFund logo">
				<p>OpenFund</p>
			</div>
			<div class="term-links">
				<a href="/legal#privacy-policy">Privacy</a>
				<a href="/legal#terms-of-service">Terms</a>
				<a href="/document">Document</a>
				<a href="/blog">Blog</a>
				<a href="/legal#help-center">Help Center</a>
			</div>
			<div class="community-links">
				<i class="fa-brands fa-square-x-twitter" onclick="window.location.href='https://x.com'"></i>
				<i class="fa-brands fa-telegram" onclick="window.location.href='https://telegram.com'"></i>
				<i class="fa-brands fa-facebook" onclick="window.location.href='https://facebook.com'"></i>
				<i class="fa-solid fa-envelope" onclick="window.location.href='mailto:support@openfund.live'"></i>
			</div>
		</div>
		<div class="term-links-mobile">
			<a href="/legal#privacy-policy">Privacy</a>
			<a href="/legal#terms-of-service">Terms</a>
			<a href="/document">Document</a>
			<a href="/blog">Blog</a>
			<a href="/legal#help-center">Help Center</a>
		</div>
	</div>
</body>
	<script src="/static/script/connect.js"></script>
   <script src="/static/script/main.js"></script>
	<script>
		const menuBtn = document.querySelector('.menu-btn');
		const mobileNav = document.querySelector('.nav-bar-mobile');
		const close_nav_bar_mobile_btn = document.getElementById("close-nav-bar-mobile-btn");
		menuBtn.addEventListener('click', () => {
			mobileNav.classList.remove('hidden');
		});

		close_nav_bar_mobile_btn.addEventListener('click', () => {
			mobileNav.classList.add('hidden');
		});

		let nonce;
      nonce = "{{ nonce }}";
      let isInvstorConnecting = true;
      const investor_wallet_connected = {{ investor_connected | tojson }};
      const raiser_loggedin = {{ raiser_logged_in | tojson }};
      const shortWallet = "{{ investor_wallet_address }}".slice(0, 6) + '...' + "{{ investor_wallet_address }}".slice(-4);
		
		const contractConfig = {
			openFundAddress: "0x392cd2aeb4a903c74e718b1ed96add7f02881bf6",
			usdtAddress: "0xDeC8197C9A95B603f65f147c1061A5aA3F3c4609",
			projectId: {{ project.id }},
			tokenContractAddress: "{{ project.token_address }}",
			usdtDecimal: 6,
			rpcUrl: "https://evm-rpc-arctic-1.sei-apis.com"
		};
		
		const openFundABI = [
			"function invest(uint256 _projectId, uint256 _units) external",
			"function voteForRefund(uint256 _projectId) external",
			"function getRefund(uint256 _projectId) external",
			"function getProjectDetails(uint256 _projectId) external view returns (address, address, uint256, uint256, uint256, uint256, uint256, uint8, bool, uint256, bool)",
			"function getInvestmentDetails(uint256 _projectId, address _investor) external view returns (uint256, bool, bool)"
		];
		
		const erc20ABI = [
			"function balanceOf(address owner) view returns (uint256)",
			"function decimals() view returns (uint8)",
			"function approve(address spender, uint256 amount) external returns (bool)",
			"function allowance(address owner, address spender) view returns (uint256)"
		];
		
		const readProvider = new ethers.JsonRpcProvider(contractConfig.rpcUrl);
		const readOnlyUsdtContract = new ethers.Contract(contractConfig.usdtAddress, erc20ABI, readProvider);
		
		let provider, signer, usdtContract, openFundContract, projectTokenContract, projectDetails, investmentDetails, remainingInvestmentAmount;
		let userAddress = "{{ investor_wallet_address }}";

		async function setupWallet() {
			const storedWallet = localStorage.getItem('selectedWallet');
			addSwitchChain(storedWallet);
			try{
				switch (storedWallet) {
				case 'metamask':
				case 'binance':
				case 'coinbase':
					if (window.ethereum) {
						provider = new ethers.BrowserProvider(window.ethereum);
						signer = await provider.getSigner();
					}
					break;
				case 'okx':
					if (window.okxwallet) {
						provider = new ethers.BrowserProvider(window.okxwallet);
						signer = await provider.getSigner();
					}
					break;
				case 'trust':
					window_provider = window.trustwallet || (window.ethereum && window.ethereum.isTrust ? window.ethereum : null);
					if (window_provider) {
						provider = new ethers.BrowserProvider(window_provider);
						signer = await provider.getSigner();
					}
					break;
				}
			
				usdtContract = new ethers.Contract(contractConfig.usdtAddress, erc20ABI, signer);
				openFundContract = new ethers.Contract(contractConfig.openFundAddress, openFundABI, signer);
				projectTokenContract = new ethers.Contract(contractConfig.tokenContractAddress, erc20ABI, signer);
				const user_token_balance = await projectTokenContract.balanceOf(userAddress);
				projectDetails = await openFundContract.getProjectDetails(contractConfig.projectId);
				investmentDetails = await openFundContract.getInvestmentDetails(contractConfig.projectId, userAddress);
				if (projectDetails[7] == 1){
					document.querySelector('.invest-btn').disabled = false;
					document.querySelector('.invest-btn').style.cursor = 'pointer';
					document.querySelector('.invest-btn').style.backgroundColor = '#000145';
					document.querySelector('.invest-btn').style.color = 'white';
					document.getElementById('usdt-amount').removeAttribute('readonly');
				}
				if (investmentDetails[1]){
					document.querySelector('.request-refund-btn').textContent = 'Voted for Refund';
				}
				currentTimestamp = Math.floor(Date.now() / 1000);
				if (!investmentDetails[1] && user_token_balance > 0 && currentTimestamp > Number({{ project.end_time }}) && currentTimestamp < Number({{ project.end_time + 3*24*60*60 }})){
					document.querySelector('.request-refund-btn').disabled = false;
					document.querySelector('.request-refund-btn').style.cursor = 'pointer';
					document.querySelector('.request-refund-btn').style.borderColor = 'black';
					document.querySelector('.request-refund-btn').style.color = 'black';
				}
				if (currentTimestamp > Number({{ project.end_time }}) && currentTimestamp < Number({{ project.end_time + 3*24*60*60 }})){
					unixTimestamp = Number({{ project.end_time + 3*24*60*60 }});
					document.getElementById("end-time-text").innerHTML = "Voting ends in: ";
				}
				if (projectDetails[7] == 3 && currentTimestamp > Number({{ project.end_time + 3*24*60*60 }}) && currentTimestamp < Number({{ project.end_time + 4*24*60*60 }})){
					unixTimestamp = Number({{ project.end_time + 4*24*60*60 }});
					document.getElementById("end-time-text").innerHTML = "Claim refund ends in: ";
				}
				if (projectDetails[7] == 3 && !investmentDetails[2] && user_token_balance > 0 && currentTimestamp < Number({{ project.end_time + 4*24*60*60 }})){
					document.querySelector('.claim-refund-btn').disabled = false;
					document.querySelector('.claim-refund-btn').style.cursor = 'pointer';
					document.querySelector('.claim-refund-btn').style.borderColor = 'black';
					document.querySelector('.claim-refund-btn').style.color = 'black';
				}
				if (investmentDetails[2]){
					document.querySelector('.claim-refund-btn').textContent = 'Refund Claimed';
				}
				remainingInvestmentAmount = 1000 - Number(ethers.formatUnits(investmentDetails[0], contractConfig.usdtDecimal));
				document.getElementById('remaining-buy-amount').textContent = remainingInvestmentAmount.toLocaleString();
					await updateUSDTBalance();
				} catch (error) {
						console.error("Error setting up wallet:", error);
				}
		}
		
		async function updateUSDTBalance() {
			try {
				const balance = await readOnlyUsdtContract.balanceOf(userAddress);
				const decimals = await readOnlyUsdtContract.decimals();
				const formattedBalance = ethers.formatUnits(balance, decimals);
				
				document.getElementById('usdt-balance').textContent = parseFloat(formattedBalance).toLocaleString();
			} catch (error) {
				console.error("Error updating USDT balance:", error);
			}
		}
		
		window.addEventListener('walletConnectionVerified', (event) => {
			if (event.detail.isConnected) {
				document.getElementById('connect-wallet-alert').style.display = 'none';
				setupWallet();
				updateUSDTBalance();
			}
		});
		
		function calculateTokensToReceive() {
			const usdtAmount = parseFloat(document.getElementById('usdt-amount').value) || 0;
			const tokenPrice = {{ project.token_price }};
			
			if (usdtAmount && tokenPrice) {
			const tokensToReceive = usdtAmount / tokenPrice;
			document.getElementById('token-to-receive').textContent = tokensToReceive.toLocaleString();
			} else {
			document.getElementById('token-to-receive').textContent = '--';
			}
		}

		async function investInProject() {
			if (!signer || !openFundContract) {
				showToastMessage("Please connect your wallet first", false);
				return;
			}
			const usdtAmountInput = document.getElementById('usdt-amount').value;
			if (!usdtAmountInput) {
				showToastMessage("Please enter USDT amount", false);
				return;
			}
			
			const usdtAmount = parseFloat(usdtAmountInput);
			if (usdtAmount <= 0 || usdtAmount % 100 !== 0 || usdtAmount > 1000) {
				showToastMessage("Amount must be a multiple of 100 USDT (max 1000 USDT)", false);
				return;
			}
			
			try {
				const address = await signer.getAddress();
				const balance = await usdtContract.balanceOf(address);
				const balanceInUsdt = ethers.formatUnits(balance, contractConfig.usdtDecimal);
				
				if (parseFloat(balanceInUsdt) < usdtAmount) {
					showToastMessage("Insufficient USDT balance", false);
					return;
				}
				
				const units = usdtAmount / 100;
				
				const requiredAllowance = ethers.parseUnits(usdtAmount.toString(), contractConfig.usdtDecimal);
				const allowance = await usdtContract.allowance(address, contractConfig.openFundAddress);
				
				if (allowance < requiredAllowance) {
					loading_spinner.classList.remove("hidden");
					overlay.classList.remove("hidden");
					showToastMessage("Approving USDT...", true);
					const approveTx = await usdtContract.approve(contractConfig.openFundAddress, requiredAllowance);
					await approveTx.wait();
					showToastMessage("USDT approved", true);
					loading_spinner.classList.add("hidden");
					overlay.classList.add("hidden");
				}
				loading_spinner.classList.remove("hidden");
				overlay.classList.remove("hidden");
				showToastMessage("Investing in project...", true);
				const projectId = {{ project.id }};
				const investTx = await openFundContract.invest(projectId, units, {
					gasLimit: 300000
				});
				
				showToastMessage("Transaction submitted, waiting for confirmation...", true);
				await investTx.wait();
				loading_spinner.classList.add("hidden");
				overlay.classList.add("hidden");
				showToastMessage("Investment successful!", true);
				
				setTimeout(() => {
					location.reload();
				}, 2000);
			
			} catch (error) {
				loading_spinner.classList.add("hidden");
				overlay.classList.add("hidden");
				console.error("Investment error:", error);
				showToastMessage("Investment failed: " + (error.reason || error.message), false);
				setTimeout(() => {
					location.reload();
				}, 1000);
			}
		}
		
		async function requestRefund() {
			if (!signer || !openFundContract) {
				showToastMessage("Please connect your wallet first", false);
				return;
			}
			
			try {
				loading_spinner.classList.remove("hidden");
				overlay.classList.remove("hidden");
				const projectId = {{ project.id }};
				showToastMessage("Submitting vote for refund...", true);
				const voteTx = await openFundContract.voteForRefund(projectId, {
					gasLimit: 200000
				});
				
				await voteTx.wait();
				showToastMessage("Vote for refund submitted successfully", true);
				loading_spinner.classList.add("hidden");
				overlay.classList.add("hidden");
				setTimeout(() => {
					location.reload();
				}, 2000);
			} catch (error) {
				loading_spinner.classList.add("hidden");
				overlay.classList.add("hidden");
				console.error("Vote error:", error);
				showToastMessage("Vote failed: " + (error.reason || error.message), false);
				setTimeout(() => {
					location.reload();
				}, 1000);
			}
		}
		
		async function claimRefund() {
			if (!signer || !openFundContract) {
				showToastMessage("Please connect your wallet first", false);
				return;
			}
			
			try {
				loading_spinner.classList.remove("hidden");
				overlay.classList.remove("hidden");
				const projectId = {{ project.id }};
				showToastMessage("Claiming refund...", true);
				const claimTx = await openFundContract.getRefund(projectId, {
					gasLimit: 300000
				});
				
				await claimTx.wait();
				showToastMessage("Refund claimed successfully", true);
				loading_spinner.classList.add("hidden");
				overlay.classList.add("hidden");
				setTimeout(() => {
					location.reload();
				}, 2000);
			} catch (error) {
				loading_spinner.classList.add("hidden");
				overlay.classList.add("hidden");
				console.error("Refund claim error:", error);
				showToastMessage("Refund claim failed: " + (error.reason || error.message), false);
				setTimeout(() => {
					location.reload();
				}, 1000);
			}
		}
		document.getElementById('usdt-amount').addEventListener('input', function(e) {
			this.value = this.value.replace(/[^0-9]/g, '');
			
			if (this.value) {
				let numValue = parseInt(this.value);
				
				if (numValue > remainingInvestmentAmount) {
						numValue = remainingInvestmentAmount;
				}
				
				if (numValue >= 100) {
						numValue = Math.round(numValue / 100) * 100;
				}
				
				this.value = numValue || '';
			}
			
			calculateTokensToReceive();
		});

		document.getElementById('usdt-amount').addEventListener('keypress', function(e) {
			if (!/^\d$/.test(e.key) && !['Backspace', 'Delete', 'ArrowLeft', 'ArrowRight'].includes(e.key)) {
				e.preventDefault();
			}
		});
		
   	document.querySelector('.invest-btn').addEventListener('click', investInProject);
		document.querySelector('.request-refund-btn').addEventListener('click', requestRefund);
   	document.querySelector('.claim-refund-btn').addEventListener('click', claimRefund);

		//Like-Dislike
		const likeButton = document.getElementById("like-button");
		const likeIcon = document.getElementById("like-icon");
		const likeCount = document.getElementById("like-count");
		
		const projectId = getProjectIdFromUrl();
		let isLiked = false;
		
		function getProjectIdFromUrl() {
			const urlParts = window.location.pathname.split('/');
			return urlParts[urlParts.indexOf('project') + 1];
		}

		if ({{ project.isLiked | tojson }}) {
        likeButton.classList.add('liked');
        likeIcon.classList.remove('fa-regular');
        likeIcon.classList.add('fa-solid');
        isLiked = true;
      }
		likeCount.textContent = {{ project.like_count }} || 0;

		likeButton.addEventListener('click', function() {
			if (!investor_wallet_connected) {
				showToastMessage("Connect your wallet to like projects", false);
				return;
			}
    
			fetch('/project-like-dislike', {
				method: 'POST',
				headers: {
				'Content-Type': 'application/json'
				},
				body: JSON.stringify({
				project_id: projectId
				})
			})
			.then(response => response.json())
			.then(data => {
				if (data.success) {
					isLiked = !isLiked;
					
					if (isLiked) {
						likeButton.classList.add('liked');
						likeIcon.classList.remove('fa-regular');
						likeIcon.classList.add('fa-solid');
						likeIcon.classList.add('like-animation');
						likeCount.textContent = (parseInt(likeCount.textContent) + 1);
					} else {
						likeButton.classList.remove('liked');
						likeIcon.classList.remove('fa-solid');
						likeIcon.classList.add('fa-regular');
						likeCount.textContent = (parseInt(likeCount.textContent) - 1);
					}
				
					setTimeout(() => {
						likeIcon.classList.remove('like-animation');
					}, 500);
				} else {
					showToastMessage("An error occurred. Please try again.", false);
				}
			})
			.catch(error => {
				console.error('Error toggling like:', error);
				showToastMessage("An error occurred. Please try again.", false);
			});
		});
	</script>
	<script src="/static/script/nav-bar.js"></script>
</html>