<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0 maximum-scale=1, user-scalable=no">
	<title>OpenFund - Invest</title>
	<link rel="icon" href="/static/app_assets/open_fund_logo.png">
	<link rel="stylesheet" href="/static/css/style.css">
	<link href="https://fonts.googleapis.com/css2?family=Poppins:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&family=Roboto:ital,wght@0,100..900;1,100..900&display=swap" rel="stylesheet">
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.2/css/all.min.css">
	<link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/toastify-js/src/toastify.min.css">
   <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/toastify-js"></script>
</head>
<body>
	<div class="loading-spinner hidden" id="loading-spinner">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 200 200"><circle fill="#000000" stroke="#000000" stroke-width="15" r="15" cx="40" cy="100"><animate attributeName="opacity" calcMode="spline" dur="2" values="1;0;1;" keySplines=".5 0 .5 1;.5 0 .5 1" repeatCount="indefinite" begin="-.4"></animate></circle><circle fill="#000000" stroke="#000000" stroke-width="15" r="15" cx="100" cy="100"><animate attributeName="opacity" calcMode="spline" dur="2" values="1;0;1;" keySplines=".5 0 .5 1;.5 0 .5 1" repeatCount="indefinite" begin="-.2"></animate></circle><circle fill="#000000" stroke="#000000" stroke-width="15" r="15" cx="160" cy="100"><animate attributeName="opacity" calcMode="spline" dur="2" values="1;0;1;" keySplines=".5 0 .5 1;.5 0 .5 1" repeatCount="indefinite" begin="0"></animate></circle></svg>
   </div>
	<!-- nav bar -->
	<div class="nav-bar">
      <div class="app-logo" onclick="window.location.href='/'">
         <img src="/static/app_assets/open_fund_logo.png" alt="OpenFund logo">
         <p>OpenFund</p>
      </div>
      <div class="nav-bar-select">
         <div class="link" onclick="window.location.href='/invest'">Invest</div>
			<div class="link" onclick="window.location.href='/blog'">Blog</div>
			<div class="link" onclick="window.location.href='/document'">Document</div>
      </div>
      <div class="authenticate">
         <button class="sign-in-up" onclick="window.location.href='/sign-up'" id="sign-in-up-btn">Log In/Sign Up</button>
         <button class="connect-wallet" id="connect-btn">
            <i class="fa-solid fa-wallet"></i>
            <div class="investor_connected_check hidden" id="investor_connected_check" style="background-color: white; color: rgb(0, 1, 69); font-size: 15px; position: absolute; bottom: -3px; right: -3px; display: flex; align-items: center; justify-content: center; border-radius: 50%;"><i class="fa-solid fa-circle-check"></i></div>
         </button>
         <button class="raiser-account hidden" id="raiser-account">
            <i class="fa-solid fa-user"></i>
         </button>
      </div>
      <button class="menu-btn">
         <i class="fa-solid fa-bars"></i>
      </button>
      <div class="investor-account-manage hidden" id="investor-account-manage">
         <p>Investor account</p>
         <input name="investor-wallet-address" id="investor-wallet-address" style="text-align: center; font-size: 12px; padding: 0; border: 0;" readonly required>
         <div class="investor-account-manage-btn" onclick="window.location.href='/edit-profile'">Edit profile</div>
         <div class="investor-account-manage-btn" id="investor-disconnect-btn">Disconnect</div>
      </div>
      <div class="raiser-account-manage hidden" id="raiser-account-manage">
         <p>Raiser account</p>
			<div class="raiser-account-manage-btn" onclick="window.location.href='/submitted-project'">Submitted projects</div>
         <div class="raiser-account-manage-btn" onclick="window.location.href='/raiser-profile/{{ raiser_id }}'">Profile</div>
         <div class="raiser-account-manage-btn" onclick="window.location.href='/edit-account'">Account settings</div>
         <div class="raiser-account-manage-btn" id="raiser-log-out-btn" onclick="window.location.href='/log-out'">Log out</div>
      </div>
   </div>
   <div class="nav-bar-mobile hidden">
      <div class="link-mobile" onclick="window.location.href='/invest'">Invest<i class="fa-solid fa-arrow-right"></i></div>
      <hr>
      <div class="link-mobile" onclick="window.location.href='/blog'">Blog<i class="fa-solid fa-arrow-right"></i></div>
      <hr>
      <div class="link-mobile" onclick="window.location.href='/document'">Document<i class="fa-solid fa-arrow-right"></i></div>
      <hr>
      <div class="authenticate-mobile">
         <button class="connect-wallet-mobile" id="connect-btn-mobile">
            Connect wallet<i class="fa-solid fa-wallet"></i>
         </button>
         <button class="sign-in-up-mobile" onclick="window.location.href='/sign-up'" id="sign-in-up-mobile-btn">Log In/Sign Up</button>
         <button class="sign-in-up-mobile" id="raiser-account-mobile-btn">Raiser Account</button>
      </div>
      <div class="investor-account-manage-mobile hidden" id="investor-account-manage-mobile">
         <p>Investor account</p>
         <input name="investor-wallet-address hidden" id="investor-wallet-address-mobile" style="text-align: center; font-size: 12px; padding: 0; border: 0;" readonly required>
         <div class="investor-account-manage-btn" onclick="window.location.href='/edit-profile'">Edit profile</div>
         <div class="investor-account-manage-btn" id="investor-disconnect-btn-mobile">Disconnect</div>
      </div>
      <div class="raiser-account-manage-mobile hidden" id="raiser-account-manage-mobile">
         <p>Raiser account</p>
			<div class="raiser-account-manage-btn" onclick="window.location.href='/submitted-project'">Submitted projects</div>
         <div class="raiser-account-manage-btn" onclick="window.location.href='/raiser-profile/{{ raiser_id }}'">Profile</div>
         <div class="raiser-account-manage-btn" onclick="window.location.href='/edit-account'">Account settings</div>
         <div class="raiser-account-manage-btn" id="raiser-log-out-btn-mobile" onclick="window.location.href='/log-out'">Log out</div>
      </div>
      <button class="close-nav-bar-mobile-btn" id="close-nav-bar-mobile-btn">Close</button>
   </div>
	 <!-- end nav bar -->
	<!-- connect wallet -->
	<div class="overlay hidden" id="overlay">
		<div class="connect-wallet-box hidden" id="connect-wallet-box">
			<button class="close-connect-wallet-btn" id="close-connect-wallet-btn">
				<i class="fa-solid fa-xmark"></i>
			</button>
			<h1>Connect wallet</h1>
			<p>(For investors only)</p>
			<hr style="width: 100px;">
			<button class="wallet_intergrated" data-wallet="metamask"><img class="wallet-icon-logo" src="/static/app_assets/metamask.png" alt="Metamask logo">Metamask</button>
         <button class="wallet_intergrated" data-wallet="binance"><img class="wallet-icon-logo" src="/static/app_assets/binance_web3.png" alt="Metamask logo">Binance Web3</button>
         <button class="wallet_intergrated" data-wallet="okx"><img class="wallet-icon-logo" src="/static/app_assets/okx_web3.png" alt="Metamask logo">OKX Web3</button>
         <button class="wallet_intergrated" data-wallet="trust"><img class="wallet-icon-logo" src="/static/app_assets/trust_wallet.png" alt="Metamask logo">Trust Wallet</button>
         <button class="wallet_intergrated" data-wallet="coinbase"><img class="wallet-icon-logo" src="/static/app_assets/coinbase_wallet.png" alt="Metamask logo">Coinbase Wallet</button>
         <p>By connecting a wallet, you agree to the OpenFundâ€™s <a style="color:black" href="/term-service">Terms of Service</a> and consent to its <a style="color:black" href="/privacy-policy">Privacy Policy</a>.</p>
		</div>
	</div>
	<style>
		.token-launch-banner{
			width: 100%;
			height: 50vh;
			display: flex;
			justify-content: center;
			align-items: center;
			flex-direction: column;
			padding-top: 50px;
			background-image: url(/static/app_assets/token-launch-banner.png);
			background-size: cover;
		}
		.token-launch-banner h1{
			font-size: clamp(3rem, 5vw, 5rem);
			margin: 0;
			color: white;
		}
		.token-launch-banner p{
			font-size: clamp(0.8rem, 2vw, 2rem);
			margin: 0;
			color: white;
		}
		.project-select{
			width: 100%;
			display: flex;
			align-items: center;
			justify-content: center;
			background-color: rgb(245, 245, 245);
		}
		.select-project-btn{
			border: solid 1px rgb(0, 1, 69);
			background-color: white;
			border-radius: 20px;
			padding: 10px 15px;
			cursor: pointer;
			margin: 20px 5px;
		}
		.project-list{
			width: 100%;
			display: flex;
			flex-direction: column;
			padding: 30px 20px;
			align-items: center;
			justify-content: center;
			box-sizing: border-box;
			gap: 20px
		}
		.project{
			width: clamp(330px, 90%, 600px);
			border: solid 1px #d8d8d8;
			background-color: white;
			border-radius: 30px;
			box-shadow: 0 10px 20px rgba(0, 0, 0, 0.05);
			overflow: hidden;
		}
		.project-header {
			padding: 20px;
			border-bottom: solid 1px #d8d8d8;
		}
		
		.project-name {
			font-size: 24px;
			font-weight: 600;
		}
		
		.raiser-name {
			font-size: 14px;
			opacity: 0.9;
		}
		
		.end-time {
			margin-top: 12px;
			font-size: 14px;
			opacity: 0.9;
		}
		
		.project-body {
			padding: 20px;
			display: flex;
			flex-direction: column;
		}
		
		.info-row {
			display: flex;
			justify-content: space-between;
			margin-bottom: 15px;
		}
		
		.info-label {
			color: #6c757d;
			font-size: 14px;
		}
		
		.info-value {
			font-weight: 600;
			font-size: 15px;
		}
		
		.stage-badge {
			display: inline-block;
			background-color: #edf2ff;
			color: #4263eb;
			padding: 5px 10px;
			border-radius: 12px;
			font-size: 12px;
			font-weight: 600;
		}
		
		.progress-container {
			margin: 20px 0;
		}
		
		.progress-label {
			display: flex;
			justify-content: space-between;
			margin-bottom: 5px;
			font-size: 14px;
		}
		
		.progress-bar {
			height: 8px;
			background-color: #e9ecef;
			border-radius: 4px;
			overflow: hidden;
			margin-bottom: 5px;
		}
		
		.progress {
			height: 100%;
			background: linear-gradient(135deg, #000145, #d14646);
			border-radius: 4px;
			width: 75%;
		}
		
		.token-info {
			font-size: clamp(8px, 2vw, 12px);
			color: #6c757d;
			display: flex;
			justify-content: space-between;
		}
		
		.refund-container {
			margin: 20px 0;
			padding: 15px;
			background-color: #f8f9fa;
			border-radius: 8px;
		}
		
		.refund-header {
			display: flex;
			justify-content: space-between;
			margin-bottom: 15px;
		}
		
		.refund-title {
			font-weight: 600;
			font-size: 14px;
		}
		
		.refund-progress-bar {
			height: 8px;
			background-color: #e9ecef;
			border-radius: 4px;
			overflow: hidden;
			margin-bottom: 5px;
		}
		
		.refund-progress {
			height: 100%;
			background: linear-gradient(90deg, #fd7e14, #ff9800);
			border-radius: 4px;
			width: 30%;
		}
		
		.view-detail-btn {
			background-color: #000145;
			color: white;
			grid-column: span 2;
			padding: 12px;
			border: none;
			border-radius: 8px;
			font-weight: 600;
			cursor: pointer;
		}

		.reload-btn{
			background-color: black;
         border: solid 1px black;
         border-radius: 10px;
         padding: 5.8px 10px;
         color: white;
         cursor: pointer;
		}

		.pagination-container {
         display: flex;
         justify-content: center;
         margin-bottom: 20px;
         gap: 5px;
      }
      .pagination-button {
         padding: 5px 10px;
         border: 1px solid #ddd;
         border-radius: 5px;
         background-color: white;
         cursor: pointer;
      }
      .pagination-button.active {
         background-color: black;
         color: white;
         border-color: black;
      }
      .pagination-button:hover:not(.active) {
         background-color: #f3f3f3;
      }
      .pagination-button.disabled {
         color: #ccc;
         border-color: #eee;
         cursor: not-allowed;
      }
      .no-projects-container {
         display: flex;
         flex-direction: column;
         align-items: center;
         justify-content: center;
         padding: 40px 20px;
         text-align: center;
      }
      .no-projects-container p {
         margin: 5px 0;
      }
		.status-failed{
			color:rgb(156, 33, 33)
		}
	</style>
	<div class="token-launch-banner">
		<h1>Invest</h1>
		<p>Get tokens before they list on other exchanges.</p>
	</div>
	<div class="project-select">
		<button class="select-project-btn" id="select-active-project-btn" onclick="updateProjectList('active')">Active</button>
		<button class="select-project-btn" id="select-completed-project-btn" onclick="updateProjectList('completed')">Completed</button>
		<button class="select-project-btn" id="select-invested-project-btn" onclick="updateProjectList('invested')">Invested</button>
	</div>
	<style>
	</style>
	<div class="project-list" id="project_list">
	</div>
	<div class="pagination-container" id="pagination-container"></div>
	<div class="footer">
      <div class="app-info">
         <div class="app-logo-footer" onclick="window.location.href='/'">
            <img src="/static/app_assets/open_fund_logo.png" alt="OpenFund logo">
            <p>OpenFund</p>
         </div>
         <div class="term-links">
            <a href="/privacy_policy">Privacy</a>
            <a href="/terms">Terms</a>
            <a href="/document">Document</a>
            <a href="/blog">Blog</a>
            <a href="/help_center">Help Center</a>
         </div>
         <div class="community-links">
            <i class="fa-brands fa-square-x-twitter" onclick="window.location.href='https://x.com'"></i>
            <i class="fa-brands fa-telegram" onclick="window.location.href='https://telegram.com'"></i>
            <i class="fa-brands fa-facebook" onclick="window.location.href='https://facebook.com'"></i>
            <i class="fa-solid fa-envelope" onclick="window.location.href='mailto:support@openfund.live'"></i>
         </div>
      </div>
      <div class="term-links-mobile">
         <a href="/privacy_policy">Privacy</a>
         <a href="/terms">Terms</a>
         <a href="/document">Document</a>
         <a href="/blog">Blog</a>
         <a href="/help_center">Help Center</a>
      </div>
   </div>
</body>
	<script src="/static/script/connect.js"></script>
   <script src="/static/script/main.js"></script>
	<script>
		//connect
		const menuBtn = document.querySelector('.menu-btn');
		const mobileNav = document.querySelector('.nav-bar-mobile');
		const close_nav_bar_mobile_btn = document.getElementById("close-nav-bar-mobile-btn");


		menuBtn.addEventListener('click', () => {
			mobileNav.classList.remove('hidden');
		});

		close_nav_bar_mobile_btn.addEventListener('click', () => {
			mobileNav.classList.add('hidden');
		});

		//select projects
		const select_active_project_btn = document.getElementById("select-active-project-btn");
		const select_completed_project_btn = document.getElementById("select-completed-project-btn");
		const select_invested_project_btn = document.getElementById("select-invested-project-btn");

		let currentPage = 1;
      const perPage = 5;
		let project_type;
		
		let nonce;
      nonce = "{{ nonce }}";
      let isInvstorConnecting = true;
      const investor_wallet_connected = {{ investor_connected | tojson }};
      const raiser_loggedin = {{ raiser_logged_in | tojson }};
      const shortWallet = "{{ investor_wallet_address }}".slice(0, 6) + '...' + "{{ investor_wallet_address }}".slice(-4);
		
		function createProjectElement(project) {
         const projectDiv = document.createElement('div');
         projectDiv.className = 'project';
         
			let unixTimestamp = Number(project.investment_end_time);
			const date = new Date(unixTimestamp * 1000);

			const options = {
				year: 'numeric',
				month: 'long',
				day: 'numeric',
				hour: '2-digit',
				minute: '2-digit',
				hour12: false
			};

			const readable = date.toLocaleString(undefined, options);
			
			let statusClass = '';
         if (project.funding_status === 'failed') {
            statusClass = 'status-failed';
			}

         projectDiv.innerHTML = `
				<div class="project-header">
					<div style="display: flex; align-items: center; justify-content: start; gap: 5px"><div style="width: 30px; height: 30px; border-radius: 50%; overflow: hidden"><img style="width: 100%; hieght: 100%; object-fit: cover" src=${project.logo_url}></div><div class="project-name">${project.name}</div></div>
					<div class="raiser-name">${project.raiser_name}</div>
        		</div>
        
        		<div class="project-body">
            
					<div class="info-row">
						<span class="info-label">Funds Raised</span>
						<span class="info-value">${project.fund_raised} USDT</span>
					</div>
					
					<div class="info-row">
						<span class="info-label">Stage</span>
						<span class="stage-badge ${statusClass}">${project.funding_status.charAt(0).toUpperCase() + project.funding_status.slice(1)}</span>
					</div>
					<div class="info-row">
						<span class="info-label">End time</span>
						<span class="info-value">${readable}</span>
					</div>
					<button class="view-detail-btn" onclick="window.location.href='/project/${project.id}'">View more</button>
				</div>
         `;
         return projectDiv;
      }

		function createPaginationButtons(currentPage, totalPages) {
         const paginationContainer = document.getElementById('pagination-container');
         paginationContainer.innerHTML = '';
         
         const prevButton = document.createElement('button');
         prevButton.classList.add('pagination-button');
         prevButton.innerHTML = '<i class="fa-solid fa-chevron-left"></i>';
         if (currentPage === 1) {
            prevButton.classList.add('disabled');
         } else {
            prevButton.addEventListener('click', () => loadProjects(currentPage - 1, project_type));
         }
         paginationContainer.appendChild(prevButton);
         
         const maxButtons = 5;
         let startPage = Math.max(1, currentPage - Math.floor(maxButtons / 2));
         let endPage = Math.min(totalPages, startPage + maxButtons - 1);
         
         if (endPage - startPage + 1 < maxButtons && startPage > 1) {
            startPage = Math.max(1, endPage - maxButtons + 1);
         }
         
         for (let i = startPage; i <= endPage; i++) {
            const pageButton = document.createElement('button');
            pageButton.classList.add('pagination-button');
            pageButton.textContent = i;
            
            if (i === currentPage) {
               pageButton.classList.add('active');
            } else {
               pageButton.addEventListener('click', () => loadProjects(i, project_type));
            }
            
            paginationContainer.appendChild(pageButton);
         }
         
         const nextButton = document.createElement('button');
         nextButton.classList.add('pagination-button');
         nextButton.innerHTML = '<i class="fa-solid fa-chevron-right"></i>';
         if (currentPage === totalPages || totalPages === 0) {
            nextButton.classList.add('disabled');
         } else {
            nextButton.addEventListener('click', () => loadProjects(currentPage + 1, project_type));
         }
         paginationContainer.appendChild(nextButton);
      }

		function loadProjects(page = 1, project_type) {
         const projectsContainer = document.getElementById('project_list');
			if (!investor_wallet_connected && project_type == 'invested'){
				projectsContainer.innerHTML = `
					<div class="no-projects-container">
						<p>Connect your wallet to continue.</p>
					</div>
				`;
			}
			else{
				loading_spinner.classList.remove('hidden');
				overlay.classList.remove("hidden");

				fetch(`/api/get-projects?page=${page}&per_page=${perPage}&type=${project_type}`)
					.then(response => response.json())
					.then(data => {
						currentPage = page;
						projectsContainer.innerHTML = '';
						
						loading_spinner.classList.add('hidden');
						overlay.classList.add("hidden");
						
						if (data.success) {
							if (data.projects.length > 0) {
								data.projects.forEach(project => {
									projectsContainer.appendChild(createProjectElement(project));
								});
								
								createPaginationButtons(data.pagination.current_page, data.pagination.total_pages);
							} else {
								projectsContainer.innerHTML = `
									<div class="no-projects-container">
										<p>No projects found.</p>
									</div>
								`;
								document.getElementById('pagination-container').innerHTML = '';
							}
						} else {
							showToastMessage(data.message || "Failed to load projects", false);
							projectsContainer.innerHTML = `
								<div class="no-projects-container">
									<p>Error loading projects.</p>
									<button class="reload-btn" onclick="loadProjects(${page}, ${project_type})">
										Try again <i class="fa-solid fa-refresh"></i>
									</button>
								</div>
							`;
						}
					})
					.catch(error => {
						console.error('Error fetching projects:', error);
						projectsContainer.innerHTML = `
							<div class="no-projects-container">
								<p>Error connecting to server.</p>
								<button class="reload-btn" onclick="loadProjects(${page}, ${project_type})">
									Try again <i class="fa-solid fa-refresh"></i>
								</button>
							</div>
						`;
					});
				}
      }

		function updateProjectList(selected){
			if (selected == 'active'){
				select_active_project_btn.style.backgroundColor = "rgb(0, 1, 69)";
				select_active_project_btn.style.color = "white";
				select_completed_project_btn.style.backgroundColor = "white";
				select_completed_project_btn.style.color = "black"
				select_invested_project_btn.style.backgroundColor = "white";
				select_invested_project_btn.style.color = "black"
				project_type = 'active'
				loadProjects(1, project_type);
			}

			if (selected == 'completed'){
				select_completed_project_btn.style.backgroundColor = "rgb(0, 1, 69)";
				select_completed_project_btn.style.color = "white";
				select_active_project_btn.style.backgroundColor = "white";
				select_active_project_btn.style.color = "black"
				select_invested_project_btn.style.backgroundColor = "white";
				select_invested_project_btn.style.color = "black"
				project_type = 'completed'
				loadProjects(1, project_type);
			}

			if (selected == 'invested'){
				select_invested_project_btn.style.backgroundColor = "rgb(0, 1, 69)";
				select_invested_project_btn.style.color = "white";
				select_active_project_btn.style.backgroundColor = "white";
				select_active_project_btn.style.color = "black"
				select_completed_project_btn.style.backgroundColor = "white";
				select_completed_project_btn.style.color = "black"
				project_type = 'invested'
				loadProjects(1, project_type);
			}
		}
		updateProjectList('active')
	</script>
	<script src="/static/script/nav-bar.js"></script>
</html>